# nod Compliance Registry: Standardized Security & Policy Rules
# Style Guide: YAML 1.2, 2-space indentation.
# All regex patterns and string values should be double-quoted.

version: "1.0.0"

profiles:
  # ---------------------------------------------------------------------------
  # EU AI ACT (Regulation 2024/1689)
  # Focus: Fundamental rights safety, prohibited practices, and high-risk systems.
  # ---------------------------------------------------------------------------
  eu_ai_act:
    badge_label: "EU AI Act Aligned"
    
    # Condition: If spec says "Risk Category: Low", skip strict Article 14/15 requirements
    conditions:
      - if:
          regex_match: "Risk Categorization.*(Low|Minimal|No Risk)"
        then:
          skip: 
            - "Human Oversight Measures"
            - "Robustness Measures"
            - "Cybersecurity Measures"

    requirements:
      # --- Article 6 & Annex III: Classification ---
      - id: "#+.*Risk Categorization"
        tags: ["Article-6", "Annex-III", "Classification"]
        severity: "CRITICAL"
        remediation: "Mandatory: Categorize the system according to EU AI Act Annex III (High-Risk/Prohibited)."
        template_url: "https://example.com/templates/eu-risk-mapping.md"
        
      # --- Article 10: Data Governance ---
      - id: "Training Data Sources"
        tags: ["Article-10", "Data-Governance"]
        severity: "HIGH"
        remediation: "Article 10: Explicitly describe training, validation, and testing data sources."
      - id: "Bias Mitigation Strategy"
        tags: ["Article-10", "Bias", "Fairness"]
        severity: "HIGH"
        remediation: "Article 10: Detail strategies used to detect and mitigate bias in datasets."
        
      # --- Article 11: Technical Documentation ---
      - id: "Technical Documentation"
        tags: ["Article-11", "Annex-IV", "Documentation"]
        severity: "HIGH"
        remediation: "Article 11: Ensure technical documentation (Annex IV) is referenced or included."
        
      # --- Article 12: Record Keeping ---
      - id: "Logging Capabilities"
        tags: ["Article-12", "Record-Keeping", "Traceability"]
        severity: "MEDIUM"
        remediation: "Article 12: System must generate logs enabling traceability of functioning."
      - id: "Record Keeping"
        tags: ["Article-12", "Retention"]
        severity: "MEDIUM"
        remediation: "Article 12: Define retention periods and storage for system logs."

      # --- Article 14: Human Oversight ---
      - id: "Human Oversight Measures"
        tags: ["Article-14", "Human-Oversight", "HITL"]
        severity: "HIGH"
        remediation: "Article 14: Describe measures for human oversight (human-in-the-loop, human-on-the-loop)."
        template_url: "https://example.com/templates/human-oversight.md"
        
      # --- Article 15: Accuracy, Robustness, Cybersecurity ---
      - id: "Robustness Measures"
        tags: ["Article-15", "Robustness", "Resilience"]
        severity: "HIGH"
        remediation: "Article 15: Specify resilience against errors, faults, and unexpected situations."
      - id: "Cybersecurity Measures"
        tags: ["Article-15", "Cybersecurity", "Adversarial"]
        severity: "HIGH"
        remediation: "Article 15: Detail protection against adversarial attacks (poisoning, evasion)."

    red_flags:
      # --- Article 5: Prohibited Practices ---
      - pattern: "real-time biometric identification"
        tags: ["Article-5", "Prohibited"]
        severity: "CRITICAL"
        remediation: "Prohibited (Art 5): Remote biometric ID in public spaces is banned (with narrow exceptions)."
      - pattern: "social scoring"
        tags: ["Article-5", "Prohibited"]
        severity: "CRITICAL"
        remediation: "Prohibited (Art 5): AI systems cannot be used for social scoring or manipulative behavior."
      - pattern: "subliminal techniques"
        tags: ["Article-5", "Prohibited"]
        severity: "CRITICAL"
        remediation: "Prohibited (Art 5): Techniques deploying subliminal messaging to distort behavior are banned."
      - pattern: "emotion recognition.*workplace"
        tags: ["Article-5", "Prohibited"]
        severity: "CRITICAL"
        remediation: "Prohibited (Art 5): Emotion recognition in workplace or education settings is generally banned."

  # ---------------------------------------------------------------------------
  # NIST AI RMF (Risk Management Framework 1.0)
  # Focus: Govern, Map, Measure, Manage (Trustworthy AI)
  # ---------------------------------------------------------------------------
  nist_ai_rmf:
    badge_label: "NIST AI RMF Aligned"
    requirements:
      # --- GOVERN: Culture & Roles ---
      - id: "Roles and Responsibilities"
        tags: ["GOVERN", "GOVERN-1.2", "Accountability"]
        severity: "MEDIUM"
        remediation: "GOVERN 1.2: Define specific roles for the AI lifecycle."
      - id: "Accountability Structure"
        tags: ["GOVERN", "GOVERN-1.2", "Accountability"]
        severity: "MEDIUM"
        remediation: "GOVERN 1.2: Define accountability chains for system outcomes."
      - id: "Legal Review"
        tags: ["GOVERN", "GOVERN-1.3", "Compliance"]
        severity: "MEDIUM"
        remediation: "GOVERN 1.3: Evidence of legal/regulatory review processes."

      # --- MAP: Context & Impact ---
      - id: "Context and Goals"
        tags: ["MAP", "MAP-1.1", "Context"]
        severity: "HIGH"
        remediation: "MAP 1.1: Document the context and business goals of the system."
        template_url: "https://example.com/templates/nist-map-context.md"
      - id: "Impact Assessment"
        tags: ["MAP", "MAP-1.1", "Impact"]
        severity: "HIGH"
        remediation: "MAP 1.1: Analyze potential negative impacts on stakeholders."
      - id: "Third-Party Risks"
        tags: ["MAP", "MAP-1.3", "Supply-Chain"]
        severity: "MEDIUM"
        remediation: "MAP 1.3: Identify risks related to third-party software or data."

      # --- MEASURE: Metrics & Evaluation ---
      - id: "Bias Metrics"
        tags: ["MEASURE", "MEASURE-2.2", "Fairness"]
        severity: "HIGH"
        remediation: "MEASURE 2.2: Define specific metrics used to quantify bias."
        template_url: "https://example.com/templates/nist-measure-bias.md"
      - id: "Fairness Evaluation"
        tags: ["MEASURE", "MEASURE-2.2", "Evaluation"]
        severity: "HIGH"
        remediation: "MEASURE 2.2: Describe how fairness is evaluated against the defined metrics."
      - id: "Validation Results"
        tags: ["MEASURE", "MEASURE-2.6", "Validation"]
        severity: "HIGH"
        remediation: "MEASURE 2.6: Include summary results from system validation/verification."

      # --- MANAGE: Treatment & Response ---
      - id: "Incident Response Plan"
        tags: ["MANAGE", "MANAGE-2.3", "Incident-Response"]
        severity: "HIGH"
        remediation: "MANAGE 2.3: Detail specific steps to respond to AI incidents."
      - id: "Risk Treatment Strategy"
        tags: ["MANAGE", "MANAGE-2.3", "Risk-Treatment"]
        severity: "HIGH"
        remediation: "MANAGE 2.3: Define strategy (avoid, accept, transfer, mitigate) for identified risks."
      - id: "Decommissioning Plan"
        tags: ["MANAGE", "MANAGE-1.3", "Lifecycle"]
        severity: "LOW"
        remediation: "MANAGE 1.3: Plan for system decommissioning or model retirement."
    
    red_flags:
      - pattern: "black box"
        tags: ["MEASURE", "Explainability", "TEV"]
        severity: "MEDIUM"
        remediation: "NIST RMF emphasizes Explainability. Avoid 'black box' architectures without interpretability layers."
      - pattern: "no evaluation planned"
        tags: ["MEASURE", "Validation", "TEV"]
        severity: "CRITICAL"
        remediation: "Continuous validation is core to the NIST RMF Measure function."

  # ---------------------------------------------------------------------------
  # GENERAL SECURITY & SUSTAINABILITY BASELINE
  # Focus: Cybersecurity hygiene and Environmental Impact
  # ---------------------------------------------------------------------------
  security_baseline:
    badge_label: "Security Hardened"
    requirements:
      - id: "Data Retention Policy"
        tags: ["Privacy", "Data-Protection"]
        severity: "MEDIUM"
        remediation: "Define how long training inputs and inference outputs are stored."
      
      # Separated Encryption Controls
      - id: "Encryption at Rest"
        tags: ["Security", "Encryption", "Storage"]
        severity: "HIGH"
        remediation: "Must explicitly state encryption protocols for stored data (e.g., AES-256)."
      - id: "Encryption in Transit"
        tags: ["Security", "Encryption", "Network"]
        severity: "HIGH"
        remediation: "Must explicitly state encryption protocols for data in motion (e.g., TLS 1.3)."
      
      # Separated Access Controls
      - id: "Authentication Mechanisms"
        tags: ["Security", "AuthN", "IAM"]
        severity: "HIGH"
        remediation: "Define how users/systems are authenticated (e.g., MFA, SSO)."
      - id: "Authorization Policy"
        tags: ["Security", "AuthZ", "IAM"]
        severity: "HIGH"
        remediation: "Define permission models (e.g., RBAC, Least Privilege)."
        
      # Sustainability
      - id: "Energy Consumption"
        tags: ["Sustainability", "Green-AI"]
        severity: "LOW"
        remediation: "Sustainability: Estimate energy consumption of training/inference."
        
    red_flags:
      - pattern: "disable auth"
        tags: ["Security", "Anti-Pattern"]
        severity: "CRITICAL"
        remediation: "Security Anti-Pattern: Do not disable authentication mechanisms in spec."
      - pattern: "hardcoded credential"
        tags: ["Security", "Anti-Pattern"]
        severity: "CRITICAL"
        remediation: "Security Anti-Pattern: Never reference hardcoded secrets or keys."
